@page
@using DotNetUniverse.Models
@using DotNetUniverse.Services.EventData
@model DotNetUniverse.Pages.SessionsModel
@{
    ViewData["Title"] = "ì„¸ì…˜ ì•„ì¹´ì´ë¸Œ";
    ViewData["OgDescription"] = ".NET Universeì—ì„œ ë°œí‘œëœ ëª¨ë“  ì„¸ì…˜ì„ ë‹¤ì‹œ ë³´ì„¸ìš”. ë‹¤ì–‘í•œ .NET ê¸°ìˆ  ì£¼ì œì˜ ì˜ìƒê³¼ ë°œí‘œ ìë£Œë¥¼ ë¬´ë£Œë¡œ ì œê³µí•©ë‹ˆë‹¤.";
}

<section class="py-5 bg-purple text-white">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="display-4 fw-bold mb-3">
                    <i class="bi bi-play-circle me-2"></i>ì„¸ì…˜ ì•„ì¹´ì´ë¸Œ
                </h1>
                <p class="lead mb-0">
                    .NET Universeì—ì„œ ë°œí‘œëœ <strong>@Model.TotalSessionCount</strong>ê°œì˜ ì„¸ì…˜ì„ ë¬´ë£Œë¡œ ë‹¤ì‹œ ë³´ì„¸ìš”.
                </p>
            </div>
            <div class="col-lg-4 text-lg-end mt-3 mt-lg-0">
                <div class="d-flex justify-content-lg-end gap-3">
                    <div class="text-center">
                        <div class="display-6 fw-bold">@Model.TotalSessionCount</div>
                        <small class="text-white-50">ì„¸ì…˜</small>
                    </div>
                    <div class="text-center">
                        <div class="display-6 fw-bold">@Model.AvailableYears.Count</div>
                        <small class="text-white-50">ì—°ë„</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="py-4 bg-light border-bottom">
    <div class="container">
        <form method="get" asp-page="/Sessions">
            <div class="row g-3 align-items-end">
                <!-- ê²€ìƒ‰ -->
                <div class="col-lg-4 col-md-6">
                    <label class="form-label small text-muted">ê²€ìƒ‰</label>
                    <div class="input-group">
                        <input type="text" class="form-control" name="Query" value="@Model.Query" 
                               placeholder="ì„¸ì…˜, ë°œí‘œì, í‚¤ì›Œë“œ..." />
                        <button class="btn btn-purple" type="submit">
                            <i class="bi bi-search"></i>
                        </button>
                    </div>
                </div>

                <!-- ì£¼ì œ í•„í„° -->
                <div class="col-lg-2 col-md-3 col-6">
                    <label class="form-label small text-muted">ì£¼ì œ</label>
                    <select class="form-select" name="Topic" onchange="this.form.submit()">
                        <option value="">ì „ì²´ ì£¼ì œ</option>
                        @foreach (SessionTopic topic in Enum.GetValues<SessionTopic>())
                        {
                            var count = Model.TopicCounts.GetValueOrDefault(topic);
                            if (count > 0)
                            {
                                <option value="@topic" selected="@(Model.Topic == topic)">
                                    @GetTopicDisplayName(topic) (@count)
                                </option>
                            }
                        }
                    </select>
                </div>

                <!-- ì—°ë„ í•„í„° -->
                <div class="col-lg-2 col-md-3 col-6">
                    <label class="form-label small text-muted">ì—°ë„</label>
                    <select class="form-select" name="Year" onchange="this.form.submit()">
                        <option value="">ì „ì²´ ì—°ë„</option>
                        @foreach (var y in Model.AvailableYears)
                        {
                            <option value="@y" selected="@(Model.Year == y)">@(y)ë…„</option>
                        }
                    </select>
                </div>

                <!-- ì •ë ¬ -->
                <div class="col-lg-2 col-md-3 col-6">
                    <label class="form-label small text-muted">ì •ë ¬</label>
                    <select class="form-select" name="Sort" onchange="this.form.submit()">
                        <option value="latest" selected="@(Model.Sort == "latest")">ìµœì‹ ìˆœ</option>
                        <option value="oldest" selected="@(Model.Sort == "oldest")">ì˜¤ë˜ëœìˆœ</option>
                        <option value="title" selected="@(Model.Sort == "title")">ì œëª©ìˆœ</option>
                        <option value="speaker" selected="@(Model.Sort == "speaker")">ë°œí‘œììˆœ</option>
                    </select>
                </div>

                <!-- í•„í„° ì´ˆê¸°í™” -->
                <div class="col-lg-2 col-md-3 col-6">
                    <a href="/Sessions" class="btn btn-outline-secondary w-100">
                        <i class="bi bi-arrow-counterclockwise me-1"></i>ì´ˆê¸°í™”
                    </a>
                </div>
            </div>
        </form>
    </div>
</section>

<section class="py-5">
    <div class="container">
        @if (Model.Sessions.Count == 0)
        {
            <div class="text-center py-5">
                <i class="bi bi-search display-1 text-muted"></i>
                <h3 class="mt-3">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                <p class="text-muted">ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë‚˜ í•„í„°ë¥¼ ì‹œë„í•´ë³´ì„¸ìš”.</p>
                <a href="/Sessions" class="btn btn-purple">ì „ì²´ ì„¸ì…˜ ë³´ê¸°</a>
            </div>
        }
        else
        {
            <div class="d-flex justify-content-between align-items-center mb-4">
                <p class="text-muted mb-0">
                    ì´ <strong>@Model.Sessions.Count</strong>ê°œì˜ ì„¸ì…˜
                    @if (Model.Topic.HasValue || Model.Year.HasValue || !string.IsNullOrWhiteSpace(Model.Query))
                    {
                        <span>(í•„í„° ì ìš©ë¨)</span>
                    }
                </p>
            </div>

            <div class="row g-4">
                @foreach (var item in Model.Sessions)
                {
                    <div class="col-xl-3 col-lg-4 col-md-6">
                        <div class="card h-100 shadow-sm hover-lift session-card">
                            <!-- ì¸ë„¤ì¼ -->
                            <div class="position-relative">
                                @if (item.Session.IsYouTubeVideo)
                                {
                                    var videoId = GetYouTubeVideoId(item.Session.VideoUrl!);
                                    <a href="/Sessions/@item.Session.Id" class="text-decoration-none">
                                        <img src="https://img.youtube.com/vi/@videoId/mqdefault.jpg" 
                                             alt="@item.Session.Title" 
                                             class="card-img-top session-thumbnail"
                                             loading="lazy" />
                                        <div class="play-overlay">
                                            <i class="bi bi-play-circle-fill"></i>
                                        </div>
                                    </a>
                                }
                                else
                                {
                                    <div class="card-img-top session-thumbnail bg-purple d-flex align-items-center justify-content-center">
                                        <i class="bi bi-film display-3 text-white-50"></i>
                                    </div>
                                }
                                <!-- ì‹œê°„ ë°°ì§€ -->
                                <span class="badge bg-dark position-absolute bottom-0 end-0 m-2">
                                    @item.Session.Duration.ToString(@"h\:mm")
                                </span>
                            </div>
                            
                            <div class="card-body d-flex flex-column">
                                <!-- í–‰ì‚¬ ì •ë³´ -->
                                <div class="mb-2">
                                    <a href="/@item.Event.Slug" class="badge bg-@item.Event.ThemeColorClass text-decoration-none">
                                        @item.Event.Event.Title
                                    </a>
                                    @if (item.Session.Topic.HasValue)
                                    {
                                        <span class="badge bg-light text-dark">@GetTopicDisplayName(item.Session.Topic.Value)</span>
                                    }
                                </div>
                                
                                <!-- ì„¸ì…˜ ì œëª© -->
                                <h6 class="card-title mb-2">
                                    <a href="/Sessions/@item.Session.Id" class="text-decoration-none text-dark stretched-link">
                                        @item.Session.Title
                                    </a>
                                </h6>
                                
                                <!-- ë°œí‘œì -->
                                <div class="mt-auto d-flex align-items-center">
                                    <img src="@item.Session.PrimarySpeaker.ResolvedImageUrl" 
                                         alt="@item.Session.PrimarySpeaker.Name"
                                         class="rounded-circle me-2"
                                         style="width: 28px; height: 28px; object-fit: cover;"
                                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" />
                                    <div class="rounded-circle me-2 bg-secondary text-white align-items-center justify-content-center" 
                                         style="width: 28px; height: 28px; display: none;">
                                        <i class="bi bi-person-fill" style="font-size: 14px;"></i>
                                    </div>
                                    <small class="text-muted">
                                        @item.Session.PrimarySpeaker.Name
                                        @if (item.Session.Speakers.Length > 1)
                                        {
                                            <span>ì™¸ @(item.Session.Speakers.Length - 1)ëª…</span>
                                        }
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
    </div>
</section>

@section Styles {
<style>
    .session-card {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .session-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.15) !important;
    }
    .session-thumbnail {
        aspect-ratio: 16 / 9;
        object-fit: cover;
    }
    .play-overlay {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 3rem;
        color: white;
        opacity: 0.8;
        transition: opacity 0.2s ease, transform 0.2s ease;
        text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
    }
    .session-card:hover .play-overlay {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1.1);
    }
    .btn-purple {
        background-color: #6f42c1;
        border-color: #6f42c1;
        color: white;
    }
    .btn-purple:hover {
        background-color: #5a32a3;
        border-color: #5a32a3;
        color: white;
    }
</style>
}

@functions {
    string GetTopicDisplayName(SessionTopic topic) => topic switch
    {
        SessionTopic.Cloud => "â˜ï¸ í´ë¼ìš°ë“œ",
        SessionTopic.Web => "ğŸŒ ì›¹",
        SessionTopic.AI => "ğŸ¤– AI",
        SessionTopic.Mobile => "ğŸ“± ëª¨ë°”ì¼",
        SessionTopic.Desktop => "ğŸ–¥ï¸ ë°ìŠ¤í¬í†±",
        SessionTopic.DevOps => "ğŸ”§ DevOps",
        SessionTopic.Performance => "âš¡ ì„±ëŠ¥",
        SessionTopic.Security => "ğŸ”’ ë³´ì•ˆ",
        SessionTopic.Data => "ğŸ’¾ ë°ì´í„°",
        SessionTopic.Gaming => "ğŸ® ê²Œì„",
        SessionTopic.General => "ğŸ“š ì¼ë°˜",
        _ => topic.ToString()
    };

    string? GetYouTubeVideoId(string url)
    {
        if (url.Contains("watch?v="))
            return url.Split("watch?v=")[1].Split('&')[0];
        if (url.Contains("youtu.be/"))
            return url.Split("youtu.be/")[1].Split('?')[0];
        return null;
    }
}
